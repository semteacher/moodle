{"version":3,"sources":["../src/main.js"],"names":["define","$","Notification","Repository","PubSub","Templates","CourseEvents","SELECTORS","STARRED_COURSES_REGION_VIEW","STARRED_COURSES_REGION","renderCourses","root","courses","length","render","nocoursesimg","find","attr","reloadContent","content","getStarredCourses","limit","offset","then","html","js","replaceNodeContents","catch","exception","registerEventListeners","subscribe","favourited","unfavorited","init"],"mappings":"AAsBAA,OAAM,6BACN,CACI,QADJ,CAEI,mBAFJ,CAGI,iCAHJ,CAII,aAJJ,CAKI,gBALJ,CAMI,oBANJ,CADM,CASN,SACIC,CADJ,CAEIC,CAFJ,CAGIC,CAHJ,CAIIC,CAJJ,CAKIC,CALJ,CAMIC,CANJ,CAOE,IAEMC,CAAAA,CAAS,CAAG,CACZC,2BAA2B,CAAE,wCADjB,CAEZC,sBAAsB,CAAE,gDAFZ,CAFlB,CAeMC,CAAa,CAAG,SAASC,CAAT,CAAeC,CAAf,CAAwB,CACxC,GAAqB,CAAjB,CAAAA,CAAO,CAACC,MAAZ,CAAwB,CACpB,MAAOR,CAAAA,CAAS,CAACS,MAAV,CAAiB,wBAAjB,CAA2C,CAC9CF,OAAO,CAAEA,CADqC,CAA3C,CAGV,CAJD,IAIO,CACH,GAAIG,CAAAA,CAAY,CAAGJ,CAAI,CAACK,IAAL,CAAUT,CAAS,CAACC,2BAApB,EAAiDS,IAAjD,CAAsD,mBAAtD,CAAnB,CACA,MAAOZ,CAAAA,CAAS,CAACS,MAAV,CAAiB,iCAAjB,CAAoD,CACvDC,YAAY,CAAEA,CADyC,CAApD,CAGV,CACJ,CA1BH,CAkCMG,CAAa,CAAG,SAASP,CAAT,CAAe,IAC3BQ,CAAAA,CAAO,CAAGR,CAAI,CAACK,IAAL,CAAUT,CAAS,CAACE,sBAApB,CADiB,CAQ/B,MAAON,CAAAA,CAAU,CAACiB,iBAAX,CALI,CACPC,KAAK,CAAE,CADA,CAEPC,MAAM,CAAE,CAFD,CAKJ,EACFC,IADE,CACG,SAASX,CAAT,CAAkB,CACpB,MAAOF,CAAAA,CAAa,CAACC,CAAD,CAAOC,CAAP,CACvB,CAHE,EAGAW,IAHA,CAGK,SAASC,CAAT,CAAeC,CAAf,CAAmB,CACvB,MAAOpB,CAAAA,CAAS,CAACqB,mBAAV,CAA8BP,CAA9B,CAAuCK,CAAvC,CAA6CC,CAA7C,CACV,CALE,EAKAE,KALA,CAKMzB,CAAY,CAAC0B,SALnB,CAMV,CAhDH,CAuDMC,CAAsB,CAAG,SAASlB,CAAT,CAAe,CACxCP,CAAM,CAAC0B,SAAP,CAAiBxB,CAAY,CAACyB,UAA9B,CAA0C,UAAW,CACjDb,CAAa,CAACP,CAAD,CAChB,CAFD,EAIAP,CAAM,CAAC0B,SAAP,CAAiBxB,CAAY,CAAC0B,WAA9B,CAA2C,UAAW,CAClDd,CAAa,CAACP,CAAD,CAChB,CAFD,CAGH,CA/DH,CA6EE,MAAO,CACHsB,IAAI,CARG,QAAPA,CAAAA,IAAO,CAAStB,CAAT,CAAe,CACtBA,CAAI,CAAGV,CAAC,CAACU,CAAD,CAAR,CAEAkB,CAAsB,CAAClB,CAAD,CAAtB,CACAO,CAAa,CAACP,CAAD,CAChB,CAEM,CAGV,CAhGK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the starred courses block.\n *\n * @copyright   2018 Simey Lameze <simey@moodle.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(\n[\n    'jquery',\n    'core/notification',\n    'block_starredcourses/repository',\n    'core/pubsub',\n    'core/templates',\n    'core_course/events'\n],\nfunction(\n    $,\n    Notification,\n    Repository,\n    PubSub,\n    Templates,\n    CourseEvents\n) {\n\n    var SELECTORS = {\n        STARRED_COURSES_REGION_VIEW: '[data-region=\"starred-courses-view\"]',\n        STARRED_COURSES_REGION: '[data-region=\"starred-courses-view-content\"]'\n    };\n\n    /**\n     * Render the starred courses.\n     *\n     * @method renderCourses\n     * @param {object} root The root element for the starred view.\n     * @param {array} courses containing array of returned courses.\n     * @returns {promise} Resolved with HTML and JS strings\n     */\n    var renderCourses = function(root, courses) {\n        if (courses.length > 0) {\n            return Templates.render('core_course/view-cards', {\n                courses: courses\n            });\n        } else {\n            var nocoursesimg = root.find(SELECTORS.STARRED_COURSES_REGION_VIEW).attr('data-nocoursesimg');\n            return Templates.render('block_starredcourses/no-courses', {\n                nocoursesimg: nocoursesimg\n            });\n        }\n    };\n\n    /**\n     * Fetch user's starred courses and reload the content of the block.\n     *\n     * @param {object} root The root element for the starred view.\n     * @returns {promise} The updated content for the block.\n     */\n    var reloadContent = function(root) {\n        var content = root.find(SELECTORS.STARRED_COURSES_REGION);\n\n        var args = {\n            limit: 0,\n            offset: 0,\n        };\n\n        return Repository.getStarredCourses(args)\n            .then(function(courses) {\n                return renderCourses(root, courses);\n            }).then(function(html, js) {\n                return Templates.replaceNodeContents(content, html, js);\n            }).catch(Notification.exception);\n    };\n\n    /**\n     * Register event listeners for the block.\n     *\n     * @param {object} root The calendar root element\n     */\n    var registerEventListeners = function(root) {\n        PubSub.subscribe(CourseEvents.favourited, function() {\n            reloadContent(root);\n        });\n\n        PubSub.subscribe(CourseEvents.unfavorited, function() {\n            reloadContent(root);\n        });\n    };\n\n    /**\n     * Initialise all of the modules for the starred courses block.\n     *\n     * @param {object} root The root element for the block.\n     */\n    var init = function(root) {\n        root = $(root);\n\n        registerEventListeners(root);\n        reloadContent(root);\n    };\n\n    return {\n        init: init\n    };\n});\n"],"file":"main.min.js"}