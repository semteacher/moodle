define ("core_message/message_drawer_view_conversation_renderer",["jquery","core/notification","core/str","core/templates","core/user_date","core_message/message_drawer_view_conversation_constants"],function(a,b,c,d,e,f){var g=f.SELECTORS,h=f.TEMPLATES,i=f.CONVERSATION_TYPES,j=function(a){return a.find(g.CONTENT_MESSAGES_CONTAINER)},k=function(a){j(a).removeClass("hidden")},l=function(a){j(a).addClass("hidden")},m=function(a){return a.find(g.SELF_CONVERSATION_MESSAGE_CONTAINER)},n=function(a){return m(a).addClass("hidden")},o=function(a){return a.find(g.CONTACT_REQUEST_SENT_MESSAGE_CONTAINER)},p=function(a){return o(a).addClass("hidden")},q=function(a){return a.find(g.CONTENT_MESSAGES_FOOTER_CONTAINER)},r=function(a){q(a).removeClass("hidden")},s=function(a){q(a).addClass("hidden")},t=function(a){return a.find(g.CONTENT_MESSAGES_FOOTER_EDIT_MODE_CONTAINER)},u=function(a){t(a).removeClass("hidden")},v=function(a){t(a).addClass("hidden")},w=function(a){return a.find(g.PLACEHOLDER_CONTAINER)},x=function(a){w(a).removeClass("hidden")},y=function(a){w(a).addClass("hidden")},z=function(a){return a.find(g.CONTENT_MESSAGES_FOOTER_REQUIRE_CONTACT_CONTAINER)},A=function(a){z(a).removeClass("hidden")},B=function(a){z(a).addClass("hidden")},C=function(a){return a.find(g.CONTENT_MESSAGES_FOOTER_REQUIRE_UNBLOCK_CONTAINER)},D=function(a){C(a).removeClass("hidden")},E=function(a){C(a).addClass("hidden")},F=function(a){return a.find(g.CONTENT_MESSAGES_FOOTER_UNABLE_TO_MESSAGE_CONTAINER)},G=function(a){F(a).removeClass("hidden")},H=function(a){F(a).addClass("hidden")},I=function(a){P(a);S(a);V(a)},J=function(a){s(a);v(a);y(a);B(a);E(a);H(a)},K=function(a){return a.find(g.CONTENT_PLACEHOLDER_CONTAINER)},L=function(a){K(a).removeClass("hidden")},M=function(a){K(a).addClass("hidden")},N=function(a){return a.find(g.HEADER)},O=function(a){N(a).removeClass("hidden")},P=function(a){N(a).addClass("hidden")},Q=function(a){return a.find(g.HEADER_EDIT_MODE)},R=function(a){Q(a).removeClass("hidden")},S=function(a){Q(a).addClass("hidden")},T=function(a){return a.find(g.HEADER_PLACEHOLDER_CONTAINER)},U=function(a){T(a).removeClass("hidden")},V=function(a){T(a).addClass("hidden")},W=function(a,b){var c=j(a);return c.find("[data-message-id=\""+b+"\"]")},X=function(a,b){var c=j(a);return c.find("[data-day-id=\""+b+"\"]")},Y=function(a){return a.find(g.MORE_MESSAGES_LOADING_ICON_CONTAINER)},Z=function(a){Y(a).removeClass("hidden")},$=function(a){Y(a).addClass("hidden")},_=function(a){return a.find(g.CONFIRM_DIALOGUE_CONTAINER)},aa=function(a){var b=_(a),c=b.siblings(":not(.hidden)");c.attr("aria-hidden",!0);c.attr("tabindex",-1);c.attr("data-confirm-dialogue-hidden",!0);b.removeClass("hidden")},ba=function(a){var b=_(a),c=b.siblings("[data-confirm-dialogue-hidden=\"true\"]");c.removeAttr("aria-hidden");c.removeAttr("tabindex");c.removeAttr("data-confirm-dialogue-hidden");b.addClass("hidden")},ca=function(a,b){Q(a).find(g.MESSAGES_SELECTED_COUNT).text(b)},da=function(a,b){return a.map(function(a){return{id:a.id,isread:a.isRead,fromloggedinuser:a.fromLoggedInUser,userfrom:a.userFrom,text:a.text,formattedtime:a.timeCreated?b[a.timeCreated]:null}})},ea=function(b,c,e,f,g){var i=j(c),k=f.map(function(a){return d.render(h.DAY,{timestamp:a.value.timestamp,messages:da(a.value.messages,g)})});return a.when.apply(a,k).then(function(){f.forEach(function(b,d){k[d].then(function(d){if(b.before){var e=X(c,b.before.timestamp);return a(d).insertBefore(e)}else{return i.append(d)}}).catch(function(){})})})},fa=function(b,c,e,f,i){var j=f.map(function(a){return a.value}),k=da(j,i);return d.render(h.MESSAGES,{messages:k}).then(function(b){var d=a(b);f.forEach(function(a){var b=d.find("[data-message-id=\""+a.value.id+"\"]");if(a.before){var e=W(c,a.before.id);return b.insertBefore(e)}else{var f=X(c,a.day.timestamp),h=f.find(g.DAY_MESSAGES_CONTAINER);return h.append(b)}})})},ga=function(a,b,c,d,e){d.forEach(function(a){var c=a.before,d=a.after,f=W(b,c.id);if(c.id!=d.id){f.attr("data-message-id",d.id)}if(c.timeCreated!=d.timeCreated){var h=e[d.timeCreated];f.find(g.LOADING_ICON_CONTAINER).addClass("hidden");f.find(g.TIME_CREATED).text(h).removeClass("hidden")}if(c.sendState!=d.sendState){var i=f.find(g.LOADING_ICON_CONTAINER),j=f.find(g.TIME_CREATED),k=f.find(g.RETRY_SEND);i.addClass("hidden");i.attr("aria-hidden","true");j.addClass("hidden");j.attr("aria-hidden","true");k.addClass("hidden");k.attr("aria-hidden","true");f.removeClass("border border-danger");switch(d.sendState){case"pending":i.removeClass("hidden");i.attr("aria-hidden","false");break;case"error":k.removeClass("hidden");k.attr("aria-hidden","false");f.addClass("border border-danger");break;case"sent":j.removeClass("hidden");j.attr("aria-hidden","false");break;}}if(c.text!=d.text){f.find(g.TEXT_CONTAINER).html(d.text)}if(c.errorMessage!=d.errorMessage){var l=f.find(g.ERROR_MESSAGE_CONTAINER),a=l.find(g.ERROR_MESSAGE);if(d.errorMessage){l.removeClass("hidden");l.attr("aria-hidden","false");a.text(d.errorMessage)}else{l.addClass("hidden");l.attr("aria-hidden","true");a.text("")}}})},ha=function(a,b){b.forEach(function(b){X(a,b.timestamp).remove()})},ia=function(a,b){b.forEach(function(b){W(a,b.id).remove()})},ja=function(b,d,f,g){var h=[],i=0<g.days.add.length,j=0<g.messages.add.length,k=0<g.messages.update.length,l=[],m=a.Deferred().resolve({}).promise();if(i){l=l.concat(g.days.add.reduce(function(a,b){return a.concat(b.value.messages.reduce(function(a,b){if(b.timeCreated){a.push(b.timeCreated)}return a},[]))},[]))}if(j){l=l.concat(g.messages.add.reduce(function(a,b){if(b.value.timeCreated){a.push(b.value.timeCreated)}return a},[]))}if(k){l=l.concat(g.messages.update.reduce(function(a,b){if(b.before.timeCreated!=b.after.timeCreated){a.push(b.after.timeCreated)}return a},[]))}if(l.length){m=c.get_string("strftimetime24","core_langconfig").then(function(a){var b=l.map(function(b){return{timestamp:b,format:a}});return e.get(b)}).then(function(a){return l.reduce(function(b,c,d){b[c]=a[d];return b},{})})}if(i){h.push(m.then(function(a){return ea(b,d,f,g.days.add,a)}))}if(j){h.push(m.then(function(a){return fa(b,d,f,g.messages.add,a)}))}if(k){h.push(m.then(function(a){return ga(b,d,f,g.messages.update,a)}))}if(0<g.days.remove.length){ha(d,g.days.remove)}if(0<g.messages.remove.length){ia(d,g.messages.remove)}return a.when.apply(a,h)},ka=function(a,b,c,e){var f=N(a),g=h.HEADER_PUBLIC;e.context.showrouteback="false"===a.attr("data-from-panel");if(e.type==i.PRIVATE){g=e.showControls?h.HEADER_PRIVATE:h.HEADER_PRIVATE_NO_CONTROLS}else if(e.type==i.SELF){g=h.HEADER_SELF}return d.render(g,e.context).then(function(a,b){d.replaceNodeContents(f,a,b)})},la=function(a,b,d,e){J(d);switch(e.type){case"placeholder":return x(d);case"add-contact":return c.get_strings([{key:"requirecontacttomessage",component:"core_message",param:e.user.fullname},{key:"isnotinyourcontacts",component:"core_message",param:e.user.fullname}]).then(function(a){var b=a[1],c=a[0],e=z(d);e.find(g.TITLE).text(b);e.find(g.TEXT).text(c);A(d);return a});case"edit-mode":return u(d);case"content":return r(d);case"unblock":return D(d);case"unable-to-message":return G(d);}return!0},ma=function(a,b,c,d){var e=j(b),f=W(b,d),g=f.position();if(g){var h=e.scrollTop()+g.top;e.scrollTop(h)}},na=function(a,b,c,d){if(d){P(a);U(a)}else{O(a);V(a)}},oa=function(a,b,c,d){if(d){l(b);L(b)}else{k(b);M(b)}},pa=function(a,b,c,d){if(d){Z(b)}else{$(b)}},qa=function(a,b,c,d,e,f,h,i,j){var k=_(b),l=d.map(function(a){return k.find(a)}),m=k.find(g.CONFIRM_DIALOGUE_CANCEL_BUTTON),n=k.find(g.CONFIRM_DIALOGUE_OKAY_BUTTON),o=k.find(g.CONFIRM_DIALOGUE_TEXT),p=k.find(g.CONFIRM_DIALOGUE_HEADER);k.find("button").addClass("hidden");if(h){m.removeClass("hidden")}else{m.addClass("hidden")}if(j){n.removeClass("hidden")}else{n.addClass("hidden")}if(f){p.removeClass("hidden");p.text(f)}else{p.addClass("hidden");p.text("")}l.forEach(function(a){a.removeClass("hidden")});o.text(e);aa(c);aa(b);if(!i){aa(a)}k.find(g.CAN_RECEIVE_FOCUS).filter(":visible").first().focus()},ra=function(a,b,c){var d=_(b),e=d.find(g.CONFIRM_DIALOGUE_CANCEL_BUTTON),f=d.find(g.CONFIRM_DIALOGUE_OKAY_BUTTON),h=d.find(g.CONFIRM_DIALOGUE_TEXT),i=d.find(g.CONFIRM_DIALOGUE_HEADER);Aa(b);ba(b);ba(c);ba(a);d.find("button").addClass("hidden");e.removeClass("hidden");f.removeClass("hidden");h.text("");i.addClass("hidden");i.text("");a.find(g.CAN_RECEIVE_FOCUS).first().focus();return!0},sa=function(a,b,d,e){if(e){if(e.canmessageevenifblocked){return c.get_string("cantblockuser","core_message",e.fullname).then(function(c){return qa(a,b,d,[],c,"",!1,!1,!0)})}else{return c.get_string("blockuserconfirm","core_message",e.fullname).then(function(c){return qa(a,b,d,[g.ACTION_CONFIRM_BLOCK],c,"",!0,!1)})}}else{return ra(a,b,d)}},ta=function(a,b,d,e){if(e){return c.get_string("unblockuserconfirm","core_message",e.fullname).then(function(c){return qa(a,b,d,[g.ACTION_CONFIRM_UNBLOCK],c,"",!0,!1)})}else{return ra(a,b,d)}},ua=function(a,b,d,e){if(e){return c.get_string("addcontactconfirm","core_message",e.fullname).then(function(c){return qa(a,b,d,[g.ACTION_CONFIRM_ADD_CONTACT],c,"",!0,!1)})}else{return ra(a,b,d)}},va=function(a,b,d,e){if(e){return c.get_string("removecontactconfirm","core_message",e.fullname).then(function(c){return qa(a,b,d,[g.ACTION_CONFIRM_REMOVE_CONTACT],c,"",!0,!1)})}else{return ra(a,b,d)}},wa=function(a,b,d,e){var f=null;if(e.type==i.SELF){f="deleteselectedmessagesconfirmselfconversation"}else{if(e.canDeleteMessagesForAllUsers){za(b);f="deleteforeveryoneselectedmessagesconfirm"}else{f="deleteselectedmessagesconfirm"}}if(e.show){return c.get_string(f,"core_message").then(function(c){return qa(a,b,d,[g.ACTION_CONFIRM_DELETE_SELECTED_MESSAGES],c,"",!0,!1)})}else{return ra(a,b,d)}},xa=function(a,b,d,e){var f=null;if(e==i.SELF){f="deleteallselfconfirm"}else if(e){f="deleteallconfirm"}if(f){return c.get_string(f,"core_message").then(function(c){return qa(a,b,d,[g.ACTION_CONFIRM_DELETE_CONVERSATION],c,"",!0,!1)})}else{return ra(a,b,d)}},ya=function(a,b,d,e){if(e){return c.get_string("userwouldliketocontactyou","core_message",e.fullname).then(function(c){var e=[g.ACTION_ACCEPT_CONTACT_REQUEST,g.ACTION_DECLINE_CONTACT_REQUEST];return qa(a,b,d,e,c,"",!1,!0)})}else{return ra(a,b,d)}},za=function(a){var b=_(a),c=b.find(g.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE_CONTAINER);c.removeClass("hidden")},Aa=function(a){var b=_(a),c=b.find(g.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE_CONTAINER),d=b.find(g.DELETE_MESSAGES_FOR_ALL_USERS_TOGGLE);d.prop("checked",!1);c.addClass("hidden")},Ba=function(a,b,c,d){if(d){a.find(g.ACTION_REQUEST_BLOCK).addClass("hidden");a.find(g.ACTION_REQUEST_UNBLOCK).removeClass("hidden")}else{a.find(g.ACTION_REQUEST_BLOCK).removeClass("hidden");a.find(g.ACTION_REQUEST_UNBLOCK).addClass("hidden")}},Ca=function(a,b,c,d){var e=a.find(g.FAVOURITE_ICON_CONTAINER),f=a.find(g.ACTION_CONFIRM_FAVOURITE),h=a.find(g.ACTION_CONFIRM_UNFAVOURITE);switch(d){case"hide":e.addClass("hidden");f.addClass("hidden");h.addClass("hidden");break;case"show-add":e.addClass("hidden");f.removeClass("hidden");h.addClass("hidden");break;case"show-remove":e.removeClass("hidden");f.addClass("hidden");h.removeClass("hidden");break;}},Da=function(a,b,c,d){var e=a.find(g.MUTED_ICON_CONTAINER),f=a.find(g.ACTION_CONFIRM_MUTE),h=a.find(g.ACTION_CONFIRM_UNMUTE);switch(d){case"hide":e.addClass("hidden");f.addClass("hidden");h.addClass("hidden");break;case"show-mute":e.addClass("hidden");f.removeClass("hidden");h.addClass("hidden");break;case"show-unmute":e.removeClass("hidden");f.addClass("hidden");h.removeClass("hidden");break;}},Ea=function(a,b,c,d){var e=a.find(g.ACTION_REQUEST_ADD_CONTACT),f=a.find(g.ACTION_REQUEST_REMOVE_CONTACT);switch(d){case"pending-contact":e.addClass("hidden");f.addClass("hidden");break;case"contact":e.addClass("hidden");f.removeClass("hidden");break;case"non-contact":e.removeClass("hidden");f.addClass("hidden");break;}},Fa=function(a,b,c,d){var e=_(b),f=e.find("button"),h=e.find(g.CONFIRM_DIALOGUE_BUTTON_TEXT),i=e.find(g.LOADING_ICON_CONTAINER);if(d){f.prop("disabled",!0);h.addClass("hidden");i.removeClass("hidden")}else{f.prop("disabled",!1);h.removeClass("hidden");i.addClass("hidden")}},Ga=function(a,b,c,d){var e=null;if(d){e=b.find(g.MESSAGE_NOT_SELECTED);e.find(g.MESSAGE_NOT_SELECTED_ICON).removeClass("hidden");P(a);R(a)}else{e=j(b);e.find(g.MESSAGE_NOT_SELECTED_ICON).addClass("hidden");e.find(g.MESSAGE_SELECTED_ICON).addClass("hidden");O(a);S(a)}},Ha=function(a,b,c,d){var e=0<d.count;if(d.add.length){d.add.forEach(function(a){var c=W(b,a);c.find(g.MESSAGE_NOT_SELECTED_ICON).addClass("hidden");c.find(g.MESSAGE_SELECTED_ICON).removeClass("hidden");c.attr("aria-checked",!0)})}if(d.remove.length){d.remove.forEach(function(a){var c=W(b,a);if(e){c.find(g.MESSAGE_NOT_SELECTED_ICON).removeClass("hidden")}c.find(g.MESSAGE_SELECTED_ICON).addClass("hidden");c.attr("aria-checked",!1)})}ca(a,d.count)},Ia=function(a,b,d,e){if(e.show&&!e.hasMessages){return c.get_strings([{key:"requirecontacttomessage",component:"core_message",param:e.user.fullname},{key:"isnotinyourcontacts",component:"core_message",param:e.user.fullname}]).then(function(c){var e=c[1],f=c[0];return qa(a,b,d,[g.ACTION_REQUEST_ADD_CONTACT],f,e,!1,!0)})}else{return ra(a,b,d)}},Ja=function(a,b,c,d){var e=m(b);if(d){e.removeClass("hidden")}else{e.addClass("hidden")}return!0},Ka=function(a,b,d,e){var f=o(b);if(e){return c.get_string("yourcontactrequestpending","core_message",e).then(function(a){f.find(g.TEXT).text(a);f.removeClass("hidden");return a})}else{f.addClass("hidden");return!0}},La=function(a,b,c){ra(a,b,c);p(b);n(b);I(a);U(a);J(c);x(c);return!0};return{render:function render(c,d,e,f){var g=[{reset:La},{conversation:ja,header:ka,footer:la,confirmBlockUser:sa,confirmUnblockUser:ta,confirmAddContact:ua,confirmRemoveContact:va,confirmDeleteSelectedMessages:wa,confirmDeleteConversation:xa,confirmContactRequest:ya,requireAddContact:Ia,selfConversationMessage:Ja,contactRequestSent:Ka},{loadingMembers:na,loadingFirstMessages:oa,loadingMessages:pa,isBlocked:Ba,isContact:Ea,isFavourite:Ca,isMuted:Da,loadingConfirmAction:Fa,inEditMode:Ga},{scrollToMessage:ma,selectedMessages:Ha}],h=function(a){var b=[];for(var g in f){if(a.hasOwnProperty(g)){var h=a[g],i=f[g];b.push(h(c,d,e,i))}}return b},i=h(g[0]);i=i.concat(h(g[1]));return a.when.apply(a,i).then(function(){for(var a=2;a<g.length;a++){h(g[a])}}).catch(b.exception)}}});
//# sourceMappingURL=message_drawer_view_conversation_renderer.min.js.map
