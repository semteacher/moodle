function _typeof(a){if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("core/modal",["jquery","core/templates","core/notification","core/key_codes","core/custom_interaction_events","core/modal_backdrop","core/event","core/modal_events"],function(a,b,c,d,e,f,g,h){var i={CONTAINER:"[data-region=\"modal-container\"]",MODAL:"[data-region=\"modal\"]",HEADER:"[data-region=\"header\"]",TITLE:"[data-region=\"title\"]",BODY:"[data-region=\"body\"]",FOOTER:"[data-region=\"footer\"]",HIDE:"[data-action=\"hide\"]",DIALOG:"[role=dialog]",FORM:"form",MENU_BAR:"[role=menubar]",HAS_Z_INDEX:".moodle-has-zindex",CAN_RECEIVE_FOCUS:"input:not([type=\"hidden\"]), a[href], button, textarea, select, [tabindex]"},j={LOADING:"core/loading",BACKDROP:"core/modal_backdrop"},k,l=0,m=function(b){this.root=a(b);this.modal=this.root.find(i.MODAL);this.header=this.modal.find(i.HEADER);this.title=this.header.find(i.TITLE);this.body=this.modal.find(i.BODY);this.footer=this.modal.find(i.FOOTER);this.hiddenSiblings=[];this.isAttached=!1;this.bodyJS=null;this.footerJS=null;this.modalCount=l++;if(!this.root.is(i.CONTAINER)){c.exception({message:"Element is not a modal container"})}if(!this.modal.length){c.exception({message:"Container does not contain a modal"})}if(!this.header.length){c.exception({message:"Modal is missing a header region"})}if(!this.title.length){c.exception({message:"Modal header is missing a title region"})}if(!this.body.length){c.exception({message:"Modal is missing a body region"})}if(!this.footer.length){c.exception({message:"Modal is missing a footer region"})}this.registerEventListeners()};m.prototype.attachToDOM=function(){if(this.isAttached){return}a("body").append(this.root);if(this.bodyJS){b.runTemplateJS(this.bodyJS);this.bodyJS=null}if(this.footerJS){b.runTemplateJS(this.footerJS);this.footerJS=null}this.isAttached=!0};m.prototype.countOtherVisibleModals=function(){var b=0;a("body").find(i.CONTAINER).each(function(c,d){d=a(d);if(!this.root.is(d)&&d.hasClass("show")){b++}}.bind(this));return b};m.prototype.getBackdrop=function(){if(!k){k=b.render(j.BACKDROP,{}).then(function(b){var c=a(b);return new f(c)}).fail(c.exception)}return k};m.prototype.getRoot=function(){return this.root};m.prototype.getModal=function(){return this.modal};m.prototype.getTitle=function(){return this.title};m.prototype.getBody=function(){return this.body};m.prototype.getFooter=function(){return this.footer};m.prototype.getModalCount=function(){return this.modalCount};m.prototype.setTitle=function(a){var b=this.getTitle();this.asyncSet(a,b.html.bind(b))};m.prototype.setBody=function(d){var e=this.getBody();if("string"==typeof d){e.html(d);g.notifyFilterContentUpdated(e);this.getRoot().trigger(h.bodyRendered,this)}else{var f="amd-modal-js-pending-id-"+this.getModalCount();M.util.js_pending(f);var i=null;e.css("overflow","hidden");if("pending"==d.state()){var k=e.innerHeight();if(100>k){k=100}e.animate({height:k+"px"},150);e.html("");i=b.render(j.LOADING,{}).then(function(b){var c=a(b).hide();e.html(c);c.fadeIn(150);return a.when(c.promise(),d)}).then(function(a){return a.fadeOut(100).promise()}).then(function(){return d})}else{i=d}i.then(function(a,c){var d=null;if(this.isVisible()){e.css("opacity",0);var f=e.innerHeight();e.html(a);e.css("height","");var i=e.innerHeight();e.css("height",f+"px");d=e.animate({height:i+"px",opacity:1},{duration:150,queue:!1}).promise()}else{e.html(a)}if(c){if(this.isAttached){b.runTemplateJS(c)}else{this.bodyJS=c}}g.notifyFilterContentUpdated(e);this.getRoot().trigger(h.bodyRendered,this);return d}.bind(this)).fail(c.exception).always(function(){e.css("height","");e.css("overflow","");e.css("opacity","");M.util.js_complete(f)}).fail(c.exception)}};m.prototype.setFooter=function(a){this.showFooter();var c=this.getFooter();if("string"==typeof a){c.html(a)}else{b.render(j.LOADING,{}).done(function(d){c.html(d);a.done(function(a,d){c.html(a);if(d){if(this.isAttached){b.runTemplateJS(d)}else{this.footerJS=d}}}.bind(this))}.bind(this))}};m.prototype.hasFooterContent=function(){return this.getFooter().children().length?!0:!1};m.prototype.hideFooter=function(){this.getFooter().addClass("hidden")};m.prototype.showFooter=function(){this.getFooter().removeClass("hidden")};m.prototype.setLarge=function(){if(this.isLarge()){return}this.getModal().addClass("modal-lg")};m.prototype.isLarge=function(){return this.getModal().hasClass("modal-lg")};m.prototype.setSmall=function(){if(this.isSmall()){return}this.getModal().removeClass("modal-lg")};m.prototype.isSmall=function(){return!this.getModal().hasClass("modal-lg")};m.prototype.calculateZIndex=function(){var b=a(i.DIALOG+", "+i.MENU_BAR+", "+i.HAS_Z_INDEX),c=parseInt(this.root.css("z-index"));b.each(function(b,d){d=a(d);var e=d.css("z-index")?parseInt(d.css("z-index")):0;if(e>c){c=e}});return c};m.prototype.isVisible=function(){return this.root.hasClass("show")};m.prototype.hasFocus=function(){var b=a(document.activeElement);return this.root.is(b)||this.root.has(b).length};m.prototype.hasTransitions=function(){return this.getRoot().hasClass("fade")};m.prototype.show=function(){if(this.isVisible()){return}if(this.hasFooterContent()){this.showFooter()}else{this.hideFooter()}if(!this.isAttached){this.attachToDOM()}this.getBackdrop().done(function(b){var c=this.calculateZIndex(),d=c+2;this.root.css("z-index",d);b.setZIndex(d-1);b.show();this.root.removeClass("hide").addClass("show");this.accessibilityShow();this.getModal().focus();a("body").addClass("modal-open");this.root.trigger(h.shown,this)}.bind(this))};m.prototype.hideIfNotForm=function(){var a=this.modal.find(i.FORM);if(0==a.length){this.hide()}};m.prototype.hide=function(){this.getBackdrop().done(function(b){if(!this.countOtherVisibleModals()){b.hide();a("body").removeClass("modal-open")}var c=parseInt(this.root.css("z-index"));this.root.css("z-index","");b.setZIndex(c-3);this.accessibilityHide();if(this.hasTransitions()){this.getRoot().one("transitionend webkitTransitionEnd oTransitionEnd",function(){this.getRoot().removeClass("show").addClass("hide")}.bind(this))}else{this.getRoot().removeClass("show").addClass("hide")}this.root.trigger(h.hidden,this)}.bind(this))};m.prototype.destroy=function(){this.root.remove();this.root.trigger(h.destroyed,this)};m.prototype.accessibilityShow=function(){a("body").children().each(function(b,c){if(!this.root.is(c)){c=a(c);var d=c.attr("aria-hidden");if("true"!==d){c.data("previous-aria-hidden",d);this.hiddenSiblings.push(c);c.attr("aria-hidden","true")}}}.bind(this));this.root.attr("aria-hidden","false")};m.prototype.accessibilityHide=function(){this.root.attr("aria-hidden","true");a.each(this.hiddenSiblings,function(b,c){c=a(c);var d=c.data("previous-aria-hidden");if("undefined"==typeof d){c.removeAttr("aria-hidden")}else{c.attr("aria-hidden",d)}});this.hiddenSiblings=[]};m.prototype.handleTabLock=function(b){if(!this.hasFocus()){return}var c=a(document.activeElement),d=this.modal.find(i.CAN_RECEIVE_FOCUS),e=d.first(),f=d.last();if(c.is(e)&&b.shiftKey){f.focus();b.preventDefault()}else if(c.is(f)&&!b.shiftKey){e.focus();b.preventDefault()}};m.prototype.registerEventListeners=function(){this.getRoot().on("keydown",function(a){if(!this.isVisible()){return}if(a.keyCode==d.tab){this.handleTabLock(a)}else if(a.keyCode==d.escape){this.hide()}}.bind(this));this.getRoot().click(function(b){if(!a(b.target).closest(i.MODAL).length){if(a(b.target).closest(i.CONTAINER).length){this.hideIfNotForm()}}}.bind(this));e.define(this.getModal(),[e.events.activate]);this.getModal().on(e.events.activate,i.HIDE,function(a,b){this.hide();b.originalEvent.preventDefault()}.bind(this))};m.prototype.asyncSet=function(b,d){var e=b;if("object"!==_typeof(b)||!b.hasOwnProperty("then")){e=a.Deferred();e.resolve(b)}e.then(function(a){d(a)}).fail(c.exception);return e};return m});
//# sourceMappingURL=modal.min.js.map
